@using Smartstore.Web.Models.Orders

@model ReturnRequestItemsModel

<div class="form-check">
    <input type="radio" asp-for="ReturnAllItems" id="ReturnAllItems" value="true" class="form-check-input" attr-disabled='(!Model.IsEditable, "disabled")'>
    <label class="form-check-label" for="ReturnAllItems">
        @T("ReturnRequests.ReturnAllItems")
    </label>
</div>
<div class="form-check mt-2">
    <input type="radio" asp-for="ReturnAllItems" id="ReturnSelectedItems" value="false" class="form-check-input" attr-disabled='(!Model.IsEditable, "disabled")'>
    <label class="form-check-label" for="ReturnSelectedItems">
        @T("ReturnRequests.ReturnSelectedItems")
    </label>
</div>

<div id="cart-items" class="cart mt-2">
    <div class="cart-body">
        @foreach (var item in Model.Items)
        {
            var quantityId = $"orderitem-quantity{item.Id}";
            <div class="cart-row">
                <div class="row">
                    @if (Model.IsEditable)
                    {
                        <div class="select-cart-item col-auto">
                            <input name="orderitem-select@(item.Id)"
                                   type="checkbox"
                                   class="form-check-input select-cart-item-checkbox"
                                   attr-checked='(item.Selected, "checked")' />
                        </div>
                    }
                    <div class="cart-item-img col-2" sm-if="item.Image != null && item.Image.HasImage()">
                        <img sm-model="item.Image" class="img-fluid" attr-alt='(item.Image.Alt.IsEmpty(), item.ProductName)' />
                    </div>
                    <div class="cart-item-data col">
                        <div class="cart-item-group cart-item-title" role="heading" aria-level="3">
                            @if (item.ProductUrl.HasValue())
                            {
                                <a href="@item.ProductUrl" class="cart-item-link" sm-language-attributes-for="item.ProductName">
                                    @item.ProductName
                                </a>
                            }
                            else
                            {
                                <span class="product-name" sm-language-attributes-for="item.ProductName">@item.ProductName</span>
                            }
                        </div>
                        <div sm-if="item.AttributeInfo.HasValue()" class="cart-item-attrs cart-item-group fs-sm">
                            @Html.Raw(item.AttributeInfo)
                        </div>
                        <div class="cart-item-price-group mt-2">
                            <span>@T("ReturnRequests.Products.Price"):</span>
                            <data asp-for="@item.UnitPrice" class="pd-finalprice-amount"></data>
                        </div>
                        <div class="cart-item-qty pd-muted">
                            <span>@T("Order.Product(s).OrderedQuantity"):</span> <span>@item.Quantity.ToString("N0") @item.QuantityUnit</span>
                        </div>
                        <div class="cart-item-return-qty mt-2">
                            @if (!Model.IsEditable)
                            {
                                <span>@T("ReturnRequests.Products.Quantity"):</span> <span>@item.SelectedReturnQuantity.ToString("N0")</span>
                            }
                            else if (item.MaxReturnQuantity > 0)
                            {
                                <label for="@quantityId" class="mb-1">@T("ReturnRequests.Products.Quantity"):</label>
                                <select id="@quantityId" name="@quantityId" class="form-control form-control-sm noskin" style="max-width: 120px">
                                    @for (var i = 0; i <= item.MaxReturnQuantity; i++)
                                    {
                                        <option value="@(i)" attr-selected='(i == item.SelectedReturnQuantity, "selected")'>@(i)</option>
                                    }
                                </select>
                            }

                            <div sm-if="item.ReturnRequests.Count > 0" class="alert alert-info small mt-2 mb-0" role="status" aria-live="polite">
                                <p>@T("ReturnRequests.Products.RequestAlreadyExists")</p>
                                @foreach (var rr in item.ReturnRequests)
                                {
                                    <dl class="row">
                                        <dt class="col-sm-2">@T("ReturnRequests.Products.Quantity")</dt>
                                        <dd class="col-sm-10 mb-0">@rr.Quantity</dd>
                                        <dt class="col-sm-2">@T("Common.Status")</dt>
                                        <dd class="col-sm-10 mb-0">@rr.ReturnRequestStatus</dd>
                                        <dt class="col-sm-2">@T("Account.CustomerReturnRequests.Date")</dt>
                                        <dd class="col-sm-10 mb-0">
                                            <time asp-for="@rr.CreatedOn" sm-format="f"></time>
                                        </dd>
                                    </dl>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
</div>


<script sm-target-zone="scripts" data-origin="return-request-items">
    $(function () {
        // TODO: (mg) Handle UI state of controls in context of "Return all items" vs. "Return selected items"
    });
</script>