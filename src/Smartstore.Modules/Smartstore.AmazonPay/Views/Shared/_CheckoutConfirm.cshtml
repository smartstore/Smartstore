<partial name="_CheckoutNavigation" />

<script data-origin="amazonpay-confirm">
    $(function () {
        // Confirm order.
        $(document).on('submitOrder', function (e) {
            e.isOrderValid = false;
            e.disableBuyButton = true;

            $.ajax({
                type: 'POST',
                url: '@Url.Action("ConfirmOrder", "AmazonPay")',
                data: $('#confirm-order-form').serialize(),
                success: function (response) {
                    if (response.success) {
                        // Redirect back to AmazonPay to complete checkout.
                        window.location = response.redirectUrl;
                    }
                    else if (!_.isEmpty(response.redirectUrl)) {
                        // Handled server side. Reject Amazon payment and redirect to payment list.
                        window.location = response.redirectUrl;
                    }
                    else if (!_.isEmpty(response.messages)) {
                        var errorEvent = jQuery.Event('reportError');
                        errorEvent.message = response.messages
                        $(document).trigger(errorEvent);
                    }
                },
                error: function (objXml) {
                    if (objXml != null && objXml.responseText != null && objXml.responseText !== '') {
                        displayNotification(objXml.responseText, 'error');
                    }
                }
            });
        });
    });
</script>